{% extends "base.html" %}

{% block title %}Dru≈ºyny - CS2 Player Tracker{% endblock %}

{% block content %}
<div class="card">
    <h1>ZarzƒÖdzanie Dru≈ºynami</h1>
</div>

<div class="card">
    <h2>Dodaj NowƒÖ Dru≈ºynƒô</h2>
    <form onsubmit="createTeam(event)">
        <div class="form-group">
            <label for="teamName">Nazwa dru≈ºyny:</label>
            <input type="text" id="teamName" required>
        </div>
        <div class="form-group">
            <label for="teamLogo">URL Logo:</label>
            <input type="text" id="teamLogo" placeholder="https://example.com/logo.png">
        </div>
        <button type="submit" class="btn">Dodaj Dru≈ºynƒô</button>
    </form>
</div>

<div class="card">
    <h2>Lista Dru≈ºyn</h2>
    <table>
        <thead>
            <tr>
                <th style="width: 80px;">Logo</th>
                <th>Nazwa</th>
                <th style="width: 200px;">Akcje</th>
            </tr>
        </thead>
        <tbody id="teamsTable">
            {% for team in teams %}
            <tr>
                <td>
                    {% if team.logo_url %}
                    <img src="{{ team.logo_url }}" alt="{{ team.name }}" style="width: 50px; height: 50px; object-fit: contain;">
                    {% else %}
                    <div style="width: 50px; height: 50px; background: #ddd; display: flex; align-items: center; justify-content: center;">üõ°Ô∏è</div>
                    {% endif %}
                </td>
                <td>{{ team.name }}</td>
                <td>
                    <button onclick="editTeam({{ team.id }}, '{{ team.name }}', '{{ team.logo_url or '' }}')" class="btn" style="padding: 0.5rem 1rem; font-size: 0.9rem; background-color: #3498db; margin-right: 5px;">Edytuj</button>
                    <button onclick="deleteTeam({{ team.id }})" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Usu≈Ñ</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_script %}
<script>
    function createTeam(event) {
        event.preventDefault();
        const name = document.getElementById('teamName').value;
        const logo_url = document.getElementById('teamLogo').value || null;

        fetch('/api/teams/', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ name, logo_url })
        }).then(res => {
            if(res.ok) window.location.reload();
            else alert("B≈ÇƒÖd tworzenia");
        });
    }

    // --- NOWA FUNKCJA EDYCJI ---
    function editTeam(id, oldName, oldLogo) {
        const newName = prompt("Edytuj nazwƒô dru≈ºyny:", oldName);
        if (newName === null) return; // Anulowano

        const newLogo = prompt("Wklej nowy link do logo (zostaw puste aby usunƒÖƒá):", oldLogo);
        if (newLogo === null) return; // Anulowano

        const body = { name: newName };
        // Je≈õli logo jest puste, wy≈õlij null, w przeciwnym razie wy≈õlij string
        if (newLogo.trim() !== "") {
            body.logo_url = newLogo;
        } else {
            body.logo_url = null;
        }

        fetch(`/api/teams/${id}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(body)
        })
        .then(response => {
            if (!response.ok) throw new Error('B≈ÇƒÖd edycji');
            return response.json();
        })
        .then(() => window.location.reload())
        .catch(err => alert(err.message));
    }

    function deleteTeam(teamId) {
        if (!confirm('Czy na pewno chcesz usunƒÖƒá tƒô dru≈ºynƒô?')) return;
        fetch(`/api/teams/${teamId}`, { method: 'DELETE' })
        .then(res => {
            if(res.ok) window.location.reload();
            else alert("B≈ÇƒÖd usuwania (sprawd≈∫ czy dru≈ºyna nie gra w meczach)");
        });
    }
</script>
{% endblock %}