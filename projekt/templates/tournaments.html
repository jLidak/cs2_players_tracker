{% extends "base.html" %}

{% block title %}Turnieje - CS2 Player Tracker{% endblock %}

{% block content %}
<div class="card">
    <h1>Zarządzanie Turniejami</h1>
</div>

<div class="card">
    <h2>Dodaj Nowy Turniej</h2>
    <form onsubmit="createTournament(event)">
        <div class="form-group">
            <label for="tournamentName">Nazwa turnieju:</label>
            <input type="text" id="tournamentName" required>
        </div>
        <div class="form-group">
            <label for="tournamentWeight">Waga turnieju (mnożnik punktów):</label>
            <input type="number" id="tournamentWeight" step="0.1" value="1.0" required>
            <small style="color: #666;">Przykład: Major = 1,0, IEM Cologne 0,8, ESL Pro League = 0,65, PGL = 0,5</small>
        </div>
        <button type="submit" class="btn">Dodaj Turniej</button>
    </form>
</div>

<div class="card">
    <h2>Lista Turniejów</h2>
    <table>
        <thead>
            <tr>
                <th>Nazwa</th>
                <th>Waga</th>
                <th style="width: 150px;">Akcje</th>
            </tr>
        </thead>
        <tbody id="tournamentsTable">
            {% for tournament in tournaments %}
            <tr>
                <td>{{ tournament.name }}</td>
                <td>{{ "%.2f"|format(tournament.weight) }}x</td>
                <td>
                    <a href="/tournament/{{ tournament.id }}" class="btn" style="padding: 0.5rem 1rem; font-size: 0.9rem; background-color: #f39c12; text-decoration: none; margin-right: 5px;">Punktacja</a>
                    <button onclick="deleteTournament({{ tournament.id }})" class="btn btn-danger" style="padding: 0.5rem 1rem; font-size: 0.9rem;">Usuń</button>
                </td>

            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}

{% block extra_script %}
<script>
    function createTournament(event) {
        event.preventDefault();
        
        const name = document.getElementById('tournamentName').value;
        const weight = parseFloat(document.getElementById('tournamentWeight').value);
        
        fetch('/api/tournaments/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name, weight })
        })
        .then(response => {
            if (!response.ok) throw new Error('Błąd tworzenia turnieju');
            return response.json();
        })
        .then(data => {
            alert('Turniej utworzony!');
            window.location.reload();
        })
        .catch(err => {
            alert('Błąd: ' + err.message);
        });
    }
    
    function deleteTournament(tournamentId) {
        if (!confirm('Czy na pewno chcesz usunąć ten turniej?')) return;
        
        fetch(`/api/tournaments/${tournamentId}`, {
            method: 'DELETE'
        })
        .then(response => {
            if (!response.ok) throw new Error('Błąd usuwania');
            return response.json();
        })
        .then(data => {
            alert('Turniej usunięty!');
            window.location.reload();
        })
        .catch(err => {
            alert('Błąd: ' + err.message);
        });
    }
</script>
{% endblock %}
